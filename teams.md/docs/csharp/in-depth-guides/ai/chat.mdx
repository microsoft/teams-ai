---
sidebar_position: 2
summary: Comprehensive guide to implementing chat generation with LLMs in Teams, covering setup with ChatPrompt and Model objects, basic message handling, and streaming responses for improved user experience.
---

import FileCodeBlock from '@site/src/components/FileCodeBlock';

# üí¨ Chat Generation

Before going through this guide, please make sure you have completed the [setup and prerequisites](./setup-and-prereqs.md) guide.

# Setup

The basic setup involves creating a `ChatPrompt` and giving it the `Model` you want to use.

```mermaid
flowchart LR
    Prompt

    subgraph Application
        Send --> Prompt
        UserMessage["User Message<br/>Hi how are you?"] --> Send
        Send --> Content["Content<br/>I am doing great! How can I help you?"]

        subgraph Setup
            Messages --> Prompt
            Instructions --> Prompt
            Options["Other options..."] --> Prompt

            Prompt --> Model
        end
    end

    subgraph LLMProvider
        Model --> AOAI["Azure Open AI"]
        Model --> OAI["Open AI"]
        Model --> Anthropic["Claude"]
        Model --> OtherModels["..."]
    end
```

## Simple chat generation

Chat generation is the the most basic way of interacting with an LLM model. It involves setting up your ChatPrompt, the Model, and sending it the message.

Import the relevant namespaces:

```csharp
[TeamsController("main")]
public class MainController
{
    [Message]
    public async Task OnMessage([Context] MessageActivity activity, [Context] IContext.Client client)
    {
        // Create the OpenAI chat model
        var model = new OpenAIChatModel(
            model: "gpt-3.5-turbo",
            apiKey: Environment.GetEnvironmentVariable("OPENAI_API_KEY")!
        );

        // Create a chat prompt
        var prompt = new OpenAIChatPrompt(
            model, new ChatPromptOptions
            {
                Description = "You are a friendly assistant who talks like a pirate",
            });

        var response = await prompt.Send(activity.Text);
        if (!string.IsNullOrEmpty(response.Content))
        {
            var responseActivity = new MessageActivity { Text = response.Content }.AddAIGenerated();
            await client.Send(responseActivity);
            // Ahoy, matey! üè¥‚Äç‚ò†Ô∏è How be ye doin' this fine day on th' high seas? What can this ol‚Äô salty sea dog help ye with? üö¢‚ò†Ô∏è
        }
    }
}
```

:::note
The current `OpenAIChatModel` implementation uses chat-completions API. The responses API is coming soon.
:::

## Streaming chat responses

LLMs can take a while to generate a response, so often streaming the response leads to a better, more responsive user experience.

:::warning
Streaming is only currently supported for single 1:1 chats, and not for groups or channels.
:::

```csharp
// Enable streaming responses
```

![Streaming the response](/screenshots/streaming-chat.gif)
