---
sidebar_position: 7
summary: Guide to implementing user feedback functionality in Teams applications, covering feedback UI components, event handling, and storage mechanisms for gathering and managing user responses to improve application performance.
---

import FileCodeBlock from '@site/src/components/FileCodeBlock';

# Feedback

User feedback is essential for the improvement of any application. Teams provides specialized UI components to help facilitate the gathering of feedback from users.

![Feedback Message](/screenshots/feedback.gif)

## Storage

Once you receive a feedback event, you can choose to store it in some persistent storage. In the example below, we are storing it in an in-memory store.

```csharp
// This store would ideally be persisted in a database
public static class FeedbackStore
{
    public static readonly Dictionary<string, FeedbackData> StoredFeedbackByMessageId = new();

    public class FeedbackData
    {
        public string IncomingMessage { get; set; } = string.Empty;
        public string OutgoingMessage { get; set; } = string.Empty;
        public int Likes { get; set; }
        public int Dislikes { get; set; }
        public List<string> Feedbacks { get; set; } = new();
    }
}
```

<!-- FileCodeBlock: feedback-loop-store -->

## Including Feedback Buttons

When sending a message that you want feedback in, simply `AddFeedback()` to the message you are sending.

```csharp
var sentMessageId = await context.Send(
    result.Content != null
        ? new MessageActivity(result.Content)
            .AddAiGenerated()
            /** Add feedback buttons via this method */
            .AddFeedback()
        : "I did not generate a response."
);

FeedbackStore.StoredFeedbackByMessageId[sentMessageId] = new FeedbackStore.FeedbackData
{
    IncomingMessage = activity.Text,
    OutgoingMessage = result.Content ?? string.Empty,
    Likes = 0,
    Dislikes = 0,
    Feedbacks = new List<string>()
};
```

<!-- FileCodeBlock: feedback-loop -->

## Handling the feedback

Once the user decides to like/dislike the message, you can handle the feedback in a received event. Once received, you can choose to include it in your persistent store.

```csharp
[Microsoft.Teams.Apps.Activities.Invokes.Message.SubmitAction]
public async Task OnFeedbackReceived([Context] FeedbackActivity activity, [Context] ILogger log)
{
    var reaction = activity.Value?.ActionValue?.Reaction;
    var feedbackJson = activity.Value?.ActionValue?.Feedback;
    
    if (activity.ReplyToId == null)
    {
        log.LogWarning("No replyToId found for messageId {ActivityId}", activity.Id);
        return;
    }
    
    var existingFeedback = FeedbackStore.StoredFeedbackByMessageId.GetValueOrDefault(activity.ReplyToId);
    /**
     * feedbackJson looks like:
     * {"feedbackText":"Nice!"}
     */
    if (existingFeedback == null)
    {
        log.LogWarning("No feedback found for messageId {ActivityId}", activity.Id);
    }
    else
    {
        var updatedFeedback = new FeedbackStore.FeedbackData
        {
            IncomingMessage = existingFeedback.IncomingMessage,
            OutgoingMessage = existingFeedback.OutgoingMessage,
            Likes = existingFeedback.Likes + (reaction == "like" ? 1 : 0),
            Dislikes = existingFeedback.Dislikes + (reaction == "dislike" ? 1 : 0),
            Feedbacks = existingFeedback.Feedbacks.Concat(new[] { feedbackJson ?? string.Empty }).ToList()
        };
        
        FeedbackStore.StoredFeedbackByMessageId[activity.Id] = updatedFeedback;
    }
}
```

<!-- FileCodeBlock: feedback-loop-handler -->